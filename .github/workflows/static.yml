name: Deploy static content to Pages

on:
  workflow_dispatch:      # æ‰‹å‹•è§¸ç™¼ï¼›å¦‚éœ€ push è‡ªå‹•éƒ¨ç½²å†æ‰“é–‹

permissions:
  contents: read
  pages: write
  id-token: write

concurrency:
  group: "pages"
  cancel-in-progress: false

jobs:
  build:
    runs-on: ubuntu-22.04
    steps:
      # 1. å–ä»£èˆŠç‰ˆ checkout
      - uses: actions/checkout@v4   # å®˜æ–¹å»ºè­°ä½¿ç”¨ latest v4 tag
        with:
            ref: workflow

      # 2. å®‰è£ç›¸ä¾ä¸¦ç”¢ç”Ÿéœæ…‹æª”
      - name: Build HTML
        run: |
          # Install Jekyll and build the site
          pip install -r require.txt
          echo -e "python download_user.py --user=6977703\n\
          python download_user.py --user=6456506" | xargs -P 5 -I {} bash -c "{}"
          echo "ğŸ¤ªğŸ¤ªğŸ¤ªğŸ¤ªğŸ¤ªğŸ¤ªğŸ¤ªğŸ¤ªğŸ¤ªğŸ¤ªğŸ¤ªğŸ¤ªğŸ¤ªğŸ¤ªğŸ¤ªğŸ¤ªğŸ¤ªğŸ¤ªğŸ¤ªğŸ¤ªğŸ¤ªğŸ¤ªğŸ¤ªğŸ¤ªğŸ¤ªğŸ¤ªğŸ¤ªğŸ¤ªğŸ¤ªğŸ¤ªğŸ¤ªğŸ¤ªğŸ¤ªğŸ¤ªğŸ¤ªğŸ¤ªğŸ¤ªğŸ¤ªğŸ¤ªğŸ¤ªğŸ¤ªğŸ¤ªğŸ¤ªğŸ¤ªğŸ¤ªğŸ¤ªğŸ¤ªğŸ¤ªğŸ¤ªğŸ¤ªğŸ¤ªğŸ¤ªğŸ¤ªğŸ¤ªğŸ¤ªğŸ¤ªğŸ¤ªğŸ¤ªğŸ¤ªğŸ¤ªğŸ¤ªğŸ¤ª"
          # Run the final command after all previous ones finish
          python csv2html.py

      # 3. å¯«å…¥ Pages metadata
      - name: Configure GitHub Pages
        uses: actions/configure-pages@v5   # æ–°ç‰ˆ v5

      # 4. æ‰“åŒ…ä¸¦ä¸Šå‚³ç¬¦åˆ Pages è¦ç¯„çš„ artifact
      - name: Upload Pages artifact
        uses: actions/upload-pages-artifact@v3
        with:
          path: build              # æŒ‡å‘éœæ…‹æª”æ ¹ç›®éŒ„
          # ä¸å¿…å†æ‰‹å‹•æŒ‡å®š name=github-pagesï¼›Action æœƒè‡ªå‹•è™•ç†

  deploy:
    runs-on: ubuntu-latest
    needs: build
    environment:
      name: github-pages
      url: ${{ steps.deployment.outputs.page_url }}
    permissions:
      pages: write
      id-token: write
    steps:
      - name: Deploy to GitHub Pages
        id: deployment
        uses: actions/deploy-pages@v4      # èˆ‡å®˜æ–¹ç¤ºä¾‹ä¸€è‡´
